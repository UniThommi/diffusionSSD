# ============================================================================
# NC-Score Configuration
# ============================================================================

[training]
# Run identifier (für separate Checkpoint-Ordner)
run_name = "nc_score_baseline_v1"

# Logging & Monitoring
enable_tensorboard = false
save_training_plots = true
save_history_json = true

# Hardware
device = "cpu"  # "cpu" or "gpu"
enable_horovod = false

# Data files
data_dir = "/pscratch/sd/t/tbuerger/data/optPhotonSensitiveSurface/MLFormatHomogeneousNCsZylSSD300PMTs"
train_file = "resum_output_0_train.hdf5"
val_file = "resum_output_0_validation.hdf5"
train_val_split = 0.8

# Hyperparameters
batch_size = 4 # 32 in CaloScore
num_epochs = 100
learning_rate = 1e-4
optimizer = "Adamax"
use_cosine_decay = true  # learning_rate
early_stop_patience = 20

# EMA
ema_decay = 0.999

# Checkpointing
checkpoint_dir = "./checkpoints"

# Event limiting (null = use all events)
max_events = 1000

# Distillation (NICHT IMPLEMENTIERT - nur Struktur)
enable_distillation = false
distillation_factor = 1

[model]
# Embedding dimension
embed_dim = 128

# ResNet (Area-Modell)
num_resnet_layers = 3
resnet_hidden_dim = 128

# UNet (Voxel-Modell pro Region)
unet_block_depth = 4    #4
unet_widths = [32, 64, 96, 128]
unet_attentions = [false, true, true, true]
unet_stride = 2
unet_kernel = 3
unet_input_embedding_dims = 16

# Area Names
LAYER_NAMES = ["PIT", "BOT", "WALL", "TOP"]

# Grid shapes pro Region (PLACEHOLDER - TODO: Echte Geometrie)
SHAPE_PIT = [36, 36, 1]
SHAPE_BOT = [20, 20, 1]
SHAPE_WALL = [80, 80, 1]
SHAPE_TOP = [40, 40, 1]

[model.padding]
PIT  = [[2, 2], [2, 2]]  # 36 → 40
BOT  = [[6, 6], [6, 6]]  # 20 → 32
WALL = 0                          # 80 → 80 (bereits teilbar)
TOP  = [[4, 4], [4, 4]]  # 40 → 48

[diffusion]
num_steps = 512
logsnr_min = -20.0
logsnr_max = 20.0

[features]
active_phi = [
    "r_NC_mm",
    "phi_NC_rad",
    "zNC_mm",
    "E_gamma_tot_keV",
    "#gamma",
    "matID"
]

[onehot]
enable_material_onehot = true
enable_volume_onehot = false

[mapping]
material_mapping_file = "/global/cfs/projectdirs/legend/users/tbuerger/postprocessing/src/mappings/globalMaterialMappings.json"
volume_mapping_file = "/global/cfs/projectdirs/legend/users/tbuerger/postprocessing/src/mappings/globalPhysVolMappings.json"

[normalization]
r_cylinder = 4300.0
z_min = -5000.0
z_max = 3920.0
angle_max = 6.283185307
E_max = 40000.0
gamma_count_max = 20.0
region_hit_max_global = 128.0
voxel_hit_max = 128.0

[normalization.area_ratios]
PIT = 3.15
BOT = 1.0
WALL = 15.99
TOP = 3.82

[regions]
pit_prefix = "00"
bot_prefix = "01"
top_prefix = "99"
expected_voxel_counts = { PIT = 1261, BOT = 400, WALL = 6394, TOP = 1528 }

[training.active_regions]
# Welche Regionen trainiert werden sollen
enabled = ["WALL"]  # Für alle 4: ["PIT", "BOT", "WALL", "TOP"]